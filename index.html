<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>International Schools Comparison</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <script type="module" src="favicon.js"></script>
  </head>

  <body>
    <h1>International Schools Comparison</h1>
    <button id="darkModeToggle" onclick="toggleDarkMode()">
      <i class="far fa-moon"></i>
    </button>
    <table>
      <thead>
        <tr>
          <th>
            <div>
              <span class="top-right">Criteria</span>
              <span class="bottom-left">School</span>
            </div>
          </th>
          <th>
            <select
              id="school1"
              onchange="updateDropdowns(); updateTable()"
            ></select>
          </th>
          <th>
            <select
              id="school2"
              onchange="updateDropdowns(); updateTable()"
            ></select>
          </th>
          <th>
            <select
              id="school3"
              onchange="updateDropdowns(); updateTable()"
            ></select>
          </th>
          <th>
            <select
              id="school4"
              onchange="updateDropdowns(); updateTable()"
            ></select>
          </th>
          <th>
            <select
              id="school5"
              onchange="updateDropdowns(); updateTable()"
            ></select>
          </th>
        </tr>
      </thead>
      <tbody id="comparison-table">
        <!-- Table rows will be populated by JavaScript -->
      </tbody>
    </table>

    <script>
      function toggleDarkMode() {
        document.body.classList.toggle("dark-mode");
        
        // Toggle between solid sun and regular moon icons
        const icon = document.getElementById("darkModeToggle").firstElementChild;
        if (document.body.classList.contains("dark-mode")) {
          icon.classList.replace("far", "fas");
          icon.classList.replace("fa-moon", "fa-sun");
        } else {
          icon.classList.replace("fas", "far");
          icon.classList.replace("fa-sun", "fa-moon");
        }
      }

      let schoolsData = {};

      // Fetch the JSON file
      fetch("schools.json")
        .then((response) => response.json())
        .then((data) => {
          schoolsData = data;
          populateDropdowns();
          updateTable();
        });

      // Populate dropdowns with school names and set different default selections
      function populateDropdowns() {
        const schoolNames = Object.keys(schoolsData);
        const dropdowns = [
          document.getElementById("school1"),
          document.getElementById("school2"),
          document.getElementById("school3"),
          document.getElementById("school4"),
          document.getElementById("school5"), // New dropdown
        ];

        dropdowns.forEach((dropdown, index) => {
          dropdown.innerHTML = ""; // Clear existing options
          schoolNames.forEach((school, schoolIndex) => {
            const option = document.createElement("option");
            option.value = school;
            option.textContent = school;
            dropdown.appendChild(option);

            // Set a different default selection for each dropdown
            if (schoolIndex === index) {
              option.selected = true;
            }
          });
        });
        updateDropdowns(); // Refresh dropdowns on load
      }

      // Update dropdowns to remove already selected schools from others
      function updateDropdowns() {
        const selectedSchools = Array.from(
          document.querySelectorAll("select")
        ).map((select) => select.value);
        const dropdowns = document.querySelectorAll("select");

        dropdowns.forEach((dropdown) => {
          const currentSelection = dropdown.value;
          dropdown.innerHTML = ""; // Clear the dropdown
          Object.keys(schoolsData).forEach((school) => {
            if (
              !selectedSchools.includes(school) ||
              school === currentSelection
            ) {
              const option = document.createElement("option");
              option.value = school;
              option.textContent = school;
              if (school === currentSelection) {
                option.selected = true;
              }
              dropdown.appendChild(option);
            }
          });
        });
      }

      // Update the table based on selected schools
      function updateTable() {
        const school1 = document.getElementById("school1").value;
        const school2 = document.getElementById("school2").value;
        const school3 = document.getElementById("school3").value;
        const school4 = document.getElementById("school4").value;
        const school5 = document.getElementById("school5").value; // New column
        const criteria = Object.keys(schoolsData[school1]);

        const tableBody = document.getElementById("comparison-table");
        tableBody.innerHTML = ""; // Clear the table body

        criteria.forEach((criterion) => {
          const row = document.createElement("tr");

          const criterionCell = document.createElement("td");
          criterionCell.textContent = criterion;
          row.appendChild(criterionCell);

          const school1Cell = document.createElement("td");
          school1Cell.textContent =
            schoolsData[school1][criterion] || "incomplete data";
          row.appendChild(school1Cell);

          const school2Cell = document.createElement("td");
          school2Cell.textContent =
            schoolsData[school2][criterion] || "incomplete data";
          row.appendChild(school2Cell);

          const school3Cell = document.createElement("td");
          school3Cell.textContent =
            schoolsData[school3][criterion] || "incomplete data";
          row.appendChild(school3Cell);

          const school4Cell = document.createElement("td");
          school4Cell.textContent =
            schoolsData[school4][criterion] || "incomplete data";
          row.appendChild(school4Cell);

          const school5Cell = document.createElement("td");
          school5Cell.textContent =
            schoolsData[school5][criterion] || "incomplete data"; // New column
          row.appendChild(school5Cell);

          tableBody.appendChild(row);
        });
      }
    </script>
  </body>
</html>
